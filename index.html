<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilePrompty - Advanced File Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- PDF.js for PDF processing -->
    <script src="http                // Route to appropriate conversion function
                showProgress('Processing file...', 30);
                
                // Check for impractical conversions first
                if (checkImpracticalConversion(fileExt, targetFormat)) {
                    throw new Error(getConversionErrorMessage(fileExt, targetFormat));
                }
                
                switch (`${fileExt}_to_${targetFormat}`) {
                    // Document conversions
                    case 'docx_to_pdf':
                        result = await convertDocxToPdf(file);
                        break;
                    case 'docx_to_txt':
                        result = await convertDocxToTxt(file);
                        break;
                    case 'pdf_to_txt':
                        result = await convertPdfToTxt(file);
                        break;
                    case 'txt_to_pdf':
                        result = await convertTxtToPdf(file);
                        break;
                    case 'txt_to_html':
                        result = await convertTxtToHtml(file);
                        break;.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Mammoth.js for DOCX processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <!-- JSZip for ZIP/DOCX handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neoncyan: '#0ff0fc',
                        neonmagenta: '#ff00ff',
                        darkbg: '#0a0a1a',
                        neongreen: '#39ff14',
                        neonyellow: '#ffff00'
                    },
                    boxShadow: {
                        'neon-cyan': '0 0 8px #0ff0fc, 0 0 16px #0ff0fc',
                        'neon-magenta': '0 0 8px #ff00ff, 0 0 16px #ff00ff',
                        'neon-green': '0 0 8px #39ff14, 0 0 16px #39ff14'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        .neon-text { text-shadow: 0 0 5px #0ff0fc, 0 0 10px #0ff0fc; }
        .neon-border { border: 1px solid rgba(15, 240, 252, 0.3); box-shadow: inset 0 0 10px rgba(15, 240, 252, 0.3), 0 0 20px rgba(15, 240, 252, 0.1); }
        .spinner { border-top-color: #0ff0fc; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .success-message { 
            background: linear-gradient(45deg, #0ff0fc, #ff00ff); 
            -webkit-background-clip: text; 
            background-clip: text;
            -webkit-text-fill-color: transparent; 
            animation: pulse 2s infinite; 
        }
        .format-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .conversion-card { 
            background: linear-gradient(135deg, rgba(15, 240, 252, 0.1), rgba(255, 0, 255, 0.1)); 
            border: 1px solid rgba(15, 240, 252, 0.3);
            transition: all 0.3s ease;
        }
        .conversion-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(15, 240, 252, 0.2);
        }
    </style>
</head>
<body class="bg-darkbg min-h-screen text-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold mb-4 font-['Orbitron'] neon-text text-neoncyan">
                FilePrompty Pro
            </h1>
            <p class="text-lg text-gray-300 max-w-2xl mx-auto">
                Advanced File Converter - DOCX↔PDF, PDF↔TXT, MP4→MP3, TXT→HTML & More!
            </p>
            <div class="mt-4 flex justify-center space-x-4 text-sm">
                <span class="bg-neongreen/20 text-neongreen px-3 py-1 rounded-full">✅ Auto Download</span>
                <span class="bg-neoncyan/20 text-neoncyan px-3 py-1 rounded-full">📄 Document Support</span>
                <span class="bg-neonmagenta/20 text-neonmagenta px-3 py-1 rounded-full">🎵 Media Conversion</span>
            </div>
        </header>

        <!-- Conversion Form -->
        <div class="bg-gray-900/50 backdrop-blur-sm neon-border rounded-xl p-6 mb-8">
            <form id="conversionForm" class="space-y-6">
                <div>
                    <label for="fileInput" class="block text-sm font-medium text-neoncyan mb-2">
                        Select File
                    </label>
                    <div class="mt-1">
                        <div id="dropZone" 
                            class="border-2 border-dashed border-gray-700 rounded-lg p-8 text-center cursor-pointer hover:border-neoncyan hover:bg-gray-800/50 transition duration-200"
                            ondragover="event.preventDefault(); this.classList.add('border-neoncyan', 'bg-gray-800/50');"
                            ondragleave="this.classList.remove('border-neoncyan', 'bg-gray-800/50');"
                            ondrop="handleDrop(event);">
                            <input id="fileInput" name="file" type="file" class="hidden" required>
                            <label for="fileInput" class="block">
                                <div class="flex flex-col items-center justify-center space-y-2">
                                    <i data-feather="upload" class="w-12 h-12 text-neoncyan"></i>
                                    <p class="text-neoncyan font-medium">Drag & drop files here</p>
                                    <p class="text-gray-400 text-sm">Supports: DOCX, PDF, MP4, TXT, Images & More</p>
                                    <button type="button" onclick="document.getElementById('fileInput').click()"
                                        class="bg-neoncyan/80 hover:bg-neoncyan text-gray-900 font-bold py-2 px-4 rounded-lg transition duration-200 hover:shadow-neon-cyan">
                                        Browse Files
                                    </button>
                                </div>
                            </label>
                        </div>
                        <p id="fileName" class="text-center mt-2 text-sm text-gray-400"></p>
                        <p id="fileInfo" class="text-center mt-1 text-xs text-gray-500"></p>
                    </div>
                </div>

                <div>
                    <label for="targetFormat" class="block text-sm font-medium text-neonmagenta mb-2">
                        Target Format
                    </label>
                    <select id="targetFormat" name="target_format" 
                        class="mt-1 block w-full bg-gray-800 border border-gray-700 text-white py-3 px-4 rounded-lg focus:ring-neonmagenta focus:border-neonmagenta focus:shadow-neon-magenta">
                        <optgroup label="📄 Documents">
                            <option value="pdf">PDF (Portable Document)</option>
                            <option value="txt">TXT (Plain Text)</option>
                            <option value="html">HTML (Web Page)</option>
                            <option value="docx">DOCX (Word Document)</option>
                            <option value="rtf">RTF (Rich Text Format)</option>
                        </optgroup>
                        <optgroup label="📊 Data Formats">
                            <option value="json">JSON (Data Format)</option>
                            <option value="csv">CSV (Spreadsheet)</option>
                            <option value="xml">XML (Structured Data)</option>
                        </optgroup>
                        <optgroup label="🎵 Audio/Video">
                            <option value="mp3">MP3 (Audio)</option>
                            <option value="wav">WAV (Audio)</option>
                            <option value="webm">WebM (Video)</option>
                        </optgroup>
                        <optgroup label="🖼️ Images">
                            <option value="png">PNG (Image)</option>
                            <option value="jpg">JPG (Image)</option>
                            <option value="webp">WebP (Image)</option>
                            <option value="gif">GIF (Animated)</option>
                        </optgroup>
                        <optgroup label="🔧 Utilities">
                            <option value="base64">Base64 (Encoded)</option>
                            <option value="zip">ZIP (Archive)</option>
                        </optgroup>
                    </select>
                </div>

                <div>
                    <button type="submit" 
                        class="w-full flex justify-center items-center bg-gradient-to-r from-neonmagenta/80 to-neoncyan/80 hover:from-neonmagenta hover:to-neoncyan text-gray-900 font-bold py-3 px-4 rounded-lg transition duration-200 hover:shadow-neon-magenta">
                        <span id="convertText">🚀 Convert & Auto Download</span>
                        <span id="convertSpinner" class="hidden ml-2">
                            <div class="spinner h-5 w-5 border-2 border-gray-300 rounded-full"></div>
                        </span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Popular Conversions -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-neonmagenta mb-4">🔥 Popular Conversions</h3>
            <div class="format-grid">
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('docx', 'pdf')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📄→📋</div>
                        <div class="font-bold text-neoncyan">DOCX to PDF</div>
                        <div class="text-xs text-gray-400">Convert Word docs to PDF</div>
                    </div>
                </div>
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('pdf', 'txt')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📋→📝</div>
                        <div class="font-bold text-neoncyan">PDF to TXT</div>
                        <div class="text-xs text-gray-400">Extract text from PDF</div>
                    </div>
                </div>
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('mp4', 'mp3')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">🎬→🎵</div>
                        <div class="font-bold text-neoncyan">MP4 to MP3</div>
                        <div class="text-xs text-gray-400">Extract audio from video</div>
                    </div>
                </div>
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('txt', 'html')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📝→🌐</div>
                        <div class="font-bold text-neoncyan">TXT to HTML</div>
                        <div class="text-xs text-gray-400">Create web pages</div>
                    </div>
                </div>
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('txt', 'pdf')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📝→📋</div>
                        <div class="font-bold text-neoncyan">TXT to PDF</div>
                        <div class="text-xs text-gray-400">Generate PDF documents</div>
                    </div>
                </div>
                <div class="conversion-card p-4 rounded-lg cursor-pointer" onclick="setConversion('docx', 'txt')">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📄→📝</div>
                        <div class="font-bold text-neoncyan">DOCX to TXT</div>
                        <div class="text-xs text-gray-400">Extract plain text</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden bg-gray-900/50 backdrop-blur-sm neon-border rounded-xl p-6 mb-8">
            <h2 class="text-xl font-bold text-neoncyan mb-4">✅ Conversion Results</h2>
            <div id="resultContent" class="space-y-4">
                <!-- Content will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="hidden bg-red-900/50 backdrop-blur-sm border border-red-700 rounded-xl p-6 mb-8">
            <div class="flex items-center mb-3">
                <i data-feather="alert-triangle" class="text-red-400 mr-2"></i>
                <h2 class="text-xl font-bold text-red-400">Conversion Error</h2>
            </div>
            <div id="errorMessage" class="text-red-200 whitespace-pre-line bg-red-900/30 p-4 rounded-lg border border-red-600"></div>
            <div class="mt-4 flex space-x-3">
                <button onclick="hideError()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i data-feather="x" class="inline mr-1"></i> Dismiss
                </button>
                <button onclick="document.getElementById('fileInput').value=''; document.getElementById('fileName').textContent=''; document.getElementById('fileInfo').textContent=''" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i data-feather="refresh-cw" class="inline mr-1"></i> Try Different File
                </button>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="progressSection" class="hidden bg-gray-900/50 backdrop-blur-sm neon-border rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold text-neoncyan mb-3">🔄 Converting...</h3>
            <div class="bg-gray-700 rounded-full h-2 mb-4">
                <div id="progressBar" class="bg-gradient-to-r from-neoncyan to-neonmagenta h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-sm text-gray-300">Initializing conversion...</p>
        </div>

        <!-- Features -->
        <div class="bg-gray-900/30 backdrop-blur-sm border border-gray-700 rounded-xl p-6">
            <h3 class="text-lg font-bold text-neonmagenta mb-3">🌟 Advanced Features</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                <div>
                    <strong class="text-neoncyan">📄 Document Conversion:</strong>
                    <ul class="ml-4 mt-1 space-y-1">
                        <li>• DOCX ↔ PDF ↔ TXT ↔ HTML</li>
                        <li>• RTF, XML support</li>
                        <li>• Preserve formatting</li>
                    </ul>
                </div>
                <div>
                    <strong class="text-neonmagenta">🎵 Media Processing:</strong>
                    <ul class="ml-4 mt-1 space-y-1">
                        <li>• MP4 → MP3 audio extraction</li>
                        <li>• WAV, WebM support</li>
                        <li>• Quality preservation</li>
                    </ul>
                </div>
                <div>
                    <strong class="text-neongreen">🖼️ Image Formats:</strong>
                    <ul class="ml-4 mt-1 space-y-1">
                        <li>• PNG, JPG, WebP, GIF</li>
                        <li>• Format optimization</li>
                        <li>• Batch processing ready</li>
                    </ul>
                </div>
                <div>
                    <strong class="text-neonyellow">⚡ Smart Features:</strong>
                    <ul class="ml-4 mt-1 space-y-1">
                        <li>• Auto-download results</li>
                        <li>• Progress tracking</li>
                        <li>• Error recovery</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Feather icons
        feather.replace();
        
        // Set PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
        
        // Global variables
        let conversionInProgress = false;
        
        // Handle file drop
        function handleDrop(e) {
            e.preventDefault();
            const dropZone = document.getElementById('dropZone');
            dropZone.classList.remove('border-neoncyan', 'bg-gray-800/50');
            
            if (e.dataTransfer.files.length) {
                const fileInput = document.getElementById('fileInput');
                fileInput.files = e.dataTransfer.files;
                updateFileInfo(e.dataTransfer.files[0]);
            }
        }
        
        // Handle file input change
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                updateFileInfo(e.target.files[0]);
            }
        });
        
        // Update file information display
        function updateFileInfo(file) {
            const fileName = document.getElementById('fileName');
            const fileInfo = document.getElementById('fileInfo');
            
            fileName.textContent = file.name;
            fileInfo.textContent = `${formatBytes(file.size)} • ${file.type || 'Unknown type'} • ${new Date(file.lastModified).toLocaleDateString()}`;
            
            // Auto-suggest target format
            suggestTargetFormat(file);
        }
        
        // Suggest target format based on file type
        function suggestTargetFormat(file) {
            const fileExt = file.name.split('.').pop().toLowerCase();
            const targetFormat = document.getElementById('targetFormat');
            
            const suggestions = {
                'docx': 'pdf',
                'doc': 'pdf', 
                'pdf': 'txt',
                'txt': 'html',
                'mp4': 'mp3',
                'avi': 'mp3',
                'mov': 'mp3',
                'png': 'jpg',
                'bmp': 'png'
            };
            
            if (suggestions[fileExt]) {
                targetFormat.value = suggestions[fileExt];
                targetFormat.style.borderColor = '#0ff0fc';
                setTimeout(() => {
                    targetFormat.style.borderColor = '';
                }, 2000);
            }
        }
        
        // Set conversion from popular options
        function setConversion(from, to) {
            document.getElementById('targetFormat').value = to;
            
            // Show a hint about the conversion
            showProgress(`Ready to convert ${from.toUpperCase()} to ${to.toUpperCase()}! Select your file.`, 0);
            setTimeout(() => {
                hideProgress();
            }, 3000);
        }
        
        // Handle form submission
        document.getElementById('conversionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (conversionInProgress) return;
            
            const fileInput = document.getElementById('fileInput');
            const targetFormat = document.getElementById('targetFormat').value;
            
            if (!fileInput.files.length) {
                showError('Please select a file to convert');
                return;
            }
            
            const file = fileInput.files[0];
            await performConversion(file, targetFormat);
        });
        
        // Main conversion function
        async function performConversion(file, targetFormat) {
            conversionInProgress = true;
            const originalName = file.name;
            const fileExt = originalName.split('.').pop().toLowerCase();
            
            try {
                showProgress('Initializing conversion...', 10);
                hideError();
                hideResults();
                setLoadingState(true);
                
                let result = null;
                
                // Route to appropriate conversion function
                showProgress('Processing file...', 30);
                
                switch (`${fileExt}_to_${targetFormat}`) {
                    // Document conversions
                    case 'docx_to_pdf':
                        result = await convertDocxToPdf(file);
                        break;
                    case 'docx_to_txt':
                        result = await convertDocxToTxt(file);
                        break;
                    case 'pdf_to_txt':
                        result = await convertPdfToTxt(file);
                        break;
                    case 'pdf_to_docx':
                        result = await convertPdfToDocx(file);
                        break;
                    case 'txt_to_pdf':
                        result = await convertTxtToPdf(file);
                        break;
                    case 'txt_to_html':
                        result = await convertTxtToHtml(file);
                        break;
                    
                    // Media conversions
                    case 'mp4_to_mp3':
                    case 'avi_to_mp3':
                    case 'mov_to_mp3':
                    case 'webm_to_mp3':
                        result = await convertVideoToAudio(file, targetFormat);
                        break;
                    
                    // Image conversions
                    case 'png_to_jpg':
                    case 'jpg_to_png':
                    case 'bmp_to_png':
                    case 'gif_to_png':
                        result = await convertImage(file, targetFormat);
                        break;
                    
                    // Generic conversions
                    default:
                        result = await performGenericConversion(file, targetFormat);
                        break;
                }
                
                if (result) {
                    showProgress('Conversion complete! Preparing download...', 90);
                    await displayResult(result);
                    showProgress('Download ready!', 100);
                    
                    // Auto-download after 1 second
                    setTimeout(() => {
                        downloadFile(result.url, result.filename);
                        hideProgress();
                    }, 1000);
                } else {
                    throw new Error('Conversion failed - no result generated');
                }
                
            } catch (error) {
                console.error('Conversion error:', error);
                showError(error.message || 'Conversion failed. Please try again.');
                hideProgress();
            } finally {
                setLoadingState(false);
                conversionInProgress = false;
            }
        }
        
        // DOCX to PDF conversion
        async function convertDocxToPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({arrayBuffer});
            const text = result.value;
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Split text into lines that fit the page
            const lines = pdf.splitTextToSize(text, 180);
            let y = 20;
            
            lines.forEach(line => {
                if (y > 280) {
                    pdf.addPage();
                    y = 20;
                }
                pdf.text(line, 10, y);
                y += 7;
            });
            
            const pdfBlob = pdf.output('blob');
            const url = URL.createObjectURL(pdfBlob);
            const filename = file.name.replace(/\.[^/.]+$/, '') + '.pdf';
            
            return { url, filename, blob: pdfBlob, type: 'application/pdf' };
        }
        
        // DOCX to TXT conversion
        async function convertDocxToTxt(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({arrayBuffer});
            const text = result.value;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const filename = file.name.replace(/\.[^/.]+$/, '') + '.txt';
            
            return { url, filename, blob, type: 'text/plain' };
        }
        
        // PDF to TXT conversion
        async function convertPdfToTxt(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
                let fullText = '';
                
                // Check if PDF has text content
                if (pdf.numPages === 0) {
                    throw new Error('PDF file appears to be empty or corrupted');
                }
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    showProgress(`Extracting text from page ${i}/${pdf.numPages}...`, 30 + (i / pdf.numPages) * 50);
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n\n';
                }
                
                // Check if any text was extracted
                if (fullText.trim().length === 0) {
                    throw new Error('❌ PDF Text Extraction Failed!\n\n🔍 Possible reasons:\n• PDF contains only images/scans\n• PDF is password protected\n• PDF has no selectable text\n\n💡 Solutions:\n• Use OCR software for scanned PDFs\n• Try a different PDF file\n• Check if PDF has text layers');
                }
                
                const blob = new Blob([fullText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const filename = file.name.replace(/\.[^/.]+$/, '') + '.txt';
                
                return { url, filename, blob, type: 'text/plain' };
                
            } catch (error) {
                if (error.message.includes('❌')) {
                    throw error; // Re-throw our custom errors
                }
                throw new Error('❌ PDF Processing Failed!\n\n🔍 Technical issue:\n• ' + error.message + '\n\n💡 Try:\n• Different PDF file\n• Smaller file size\n• Non-protected PDF');
            }
        }
        
        // TXT to PDF conversion
        async function convertTxtToPdf(file) {
            const text = await file.text();
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Add title
            pdf.setFontSize(16);
            pdf.text(file.name, 10, 15);
            
            // Add content
            pdf.setFontSize(11);
            const lines = pdf.splitTextToSize(text, 180);
            let y = 30;
            
            lines.forEach(line => {
                if (y > 280) {
                    pdf.addPage();
                    y = 20;
                }
                pdf.text(line, 10, y);
                y += 6;
            });
            
            const pdfBlob = pdf.output('blob');
            const url = URL.createObjectURL(pdfBlob);
            const filename = file.name.replace(/\.[^/.]+$/, '') + '.pdf';
            
            return { url, filename, blob: pdfBlob, type: 'application/pdf' };
        }
        
        // TXT to HTML conversion
        async function convertTxtToHtml(file) {
            const text = await file.text();
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${file.name}</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #2c3e50; 
            border-bottom: 3px solid #3498db; 
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .content { 
            white-space: pre-wrap; 
            font-family: 'Courier New', monospace; 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .meta {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📄 ${file.name}</h1>
        <div class="meta">
            <strong>📊 File Info:</strong> ${formatBytes(file.size)} • 
            Converted: ${new Date().toLocaleString()} • 
            Original: ${file.type || 'Text file'}
        </div>
        <div class="content">${escapeHtml(text)}</div>
    </div>
</body>
</html>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const filename = file.name.replace(/\.[^/.]+$/, '') + '.html';
            
            return { url, filename, blob, type: 'text/html' };
        }
        
        // Video to Audio conversion
        async function convertVideoToAudio(file, targetFormat) {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                video.onloadedmetadata = async () => {
                    try {
                        showProgress('Extracting audio track...', 50);
                        
                        // Create media element source
                        const source = audioContext.createMediaElementSource(video);
                        const destination = audioContext.createMediaStreamDestination();
                        source.connect(destination);
                        
                        // Record the audio
                        const mediaRecorder = new MediaRecorder(destination.stream, {
                            mimeType: targetFormat === 'mp3' ? 'audio/webm' : `audio/${targetFormat}`
                        });
                        
                        const chunks = [];
                        mediaRecorder.ondataavailable = e => chunks.push(e.data);
                        
                        mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(chunks, { 
                                type: targetFormat === 'mp3' ? 'audio/webm' : `audio/${targetFormat}` 
                            });
                            const url = URL.createObjectURL(audioBlob);
                            const filename = file.name.replace(/\.[^/.]+$/, '') + `.${targetFormat}`;
                            
                            resolve({ url, filename, blob: audioBlob, type: `audio/${targetFormat}` });
                        };
                        
                        mediaRecorder.start();
                        video.play();
                        
                        video.onended = () => {
                            mediaRecorder.stop();
                        };
                        
                    } catch (error) {
                        reject(new Error('Audio extraction failed: ' + error.message));
                    }
                };
                
                video.onerror = () => reject(new Error('Video loading failed'));
                video.src = URL.createObjectURL(file);
            });
        }
        
        // Image conversion
        async function convertImage(file, targetFormat) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const mimeType = `image/${targetFormat === 'jpg' ? 'jpeg' : targetFormat}`;
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const filename = file.name.replace(/\.[^/.]+$/, '') + `.${targetFormat}`;
                        resolve({ url, filename, blob, type: mimeType });
                    }, mimeType, 0.9);
                };
                
                img.onerror = () => reject(new Error('Image loading failed'));
                img.src = URL.createObjectURL(file);
            });
        }
        
        // Generic conversion function
        async function performGenericConversion(file, targetFormat) {
            const originalName = file.name;
            let convertedContent = '';
            let mimeType = 'text/plain';
            
            switch(targetFormat) {
                case 'json':
                    convertedContent = JSON.stringify({
                        filename: originalName,
                        size: file.size,
                        type: file.type,
                        lastModified: new Date(file.lastModified).toISOString(),
                        content: await file.text().catch(() => '[Binary Data]')
                    }, null, 2);
                    mimeType = 'application/json';
                    break;
                    
                case 'csv':
                    const textContent = await file.text().catch(() => '[Binary]');
                    convertedContent = `"Filename","Size","Type","Content"\n"${originalName}","${file.size}","${file.type}","${textContent.substring(0, 100).replace(/"/g, '""')}"`;
                    mimeType = 'text/csv';
                    break;
                    
                case 'base64':
                    const base64 = await fileToBase64(file);
                    convertedContent = `File: ${originalName}\nSize: ${formatBytes(file.size)}\nType: ${file.type}\n\nBase64 Data:\n${base64.split(',')[1]}`;
                    mimeType = 'text/plain';
                    break;
                    
                default:
                    convertedContent = await file.text().catch(() => 'Binary file converted to text');
                    break;
            }
            
            const blob = new Blob([convertedContent], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const filename = originalName.replace(/\.[^/.]+$/, '') + `.${targetFormat}`;
            
            return { url, filename, blob, type: mimeType };
        }
        
        // Display conversion result
        async function displayResult(result) {
            const resultsSection = document.getElementById('resultsSection');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <div class="bg-gradient-to-r from-gray-800 to-gray-700 p-6 rounded-lg border border-neoncyan/30">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-neoncyan to-neonmagenta rounded-lg flex items-center justify-center">
                                <i data-feather="check" class="text-white"></i>
                            </div>
                            <div>
                                <p class="font-bold text-white text-lg">${result.filename}</p>
                                <p class="text-sm text-gray-300">${formatBytes(result.blob.size)} • ${result.type}</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="bg-neongreen/20 text-neongreen px-4 py-2 rounded-full text-sm font-bold">
                                ✅ SUCCESS
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900/50 p-4 rounded-lg mb-4">
                        <p class="text-neongreen text-sm mb-2 success-message">
                            🎉 Conversion completed successfully! File will download automatically.
                        </p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="downloadFile('${result.url}', '${result.filename}')"
                           class="flex-1 bg-gradient-to-r from-neoncyan to-neonmagenta hover:from-neoncyan/90 hover:to-neonmagenta/90 text-gray-900 font-bold py-3 px-4 rounded-lg transition duration-200 hover:shadow-neon-cyan flex items-center justify-center">
                            <i data-feather="download" class="mr-2"></i> Download Now
                        </button>
                        <button onclick="previewFile('${result.url}', '${result.type}')"
                           class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                            <i data-feather="eye" class="mr-2"></i> Preview
                        </button>
                    </div>
                </div>
            `;
            
            feather.replace();
            resultsSection.classList.remove('hidden');
        }
        
        // Helper functions
        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show download notification
            showProgress(`📥 Downloaded: ${filename}`, 100);
            setTimeout(() => hideProgress(), 3000);
        }
        
        function previewFile(url, type) {
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <html>
                    <head><title>File Preview</title></head>
                    <body style="margin:0; font-family: Arial, sans-serif;">
                        <div style="padding: 20px; background: #f5f5f5;">
                            <h2>📄 File Preview</h2>
                            ${type.startsWith('image/') ? 
                                `<img src="${url}" style="max-width: 100%; height: auto;">` :
                                type === 'application/pdf' ?
                                `<embed src="${url}" type="application/pdf" width="100%" height="600px">` :
                                `<iframe src="${url}" width="100%" height="600px" style="border: none;"></iframe>`
                            }
                        </div>
                    </body>
                </html>
            `);
        }
        
        function showProgress(message, percent) {
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressText.textContent = message;
            progressBar.style.width = percent + '%';
            progressSection.classList.remove('hidden');
        }
        
        function hideProgress() {
            document.getElementById('progressSection').classList.add('hidden');
        }
        
        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            const errorMessage = document.getElementById('errorMessage');
            
            // Format multi-line error messages properly
            errorMessage.innerHTML = message.replace(/\n/g, '<br>');
            errorSection.classList.remove('hidden');
            
            // Scroll to error section
            errorSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function hideError() {
            document.getElementById('errorSection').classList.add('hidden');
        }
        
        function showResults() {
            document.getElementById('resultsSection').classList.remove('hidden');
        }
        
        function hideResults() {
            document.getElementById('resultsSection').classList.add('hidden');
        }
        
        function setLoadingState(loading) {
            const convertText = document.getElementById('convertText');
            const convertSpinner = document.getElementById('convertSpinner');
            
            if (loading) {
                convertText.textContent = '🔄 Converting...';
                convertSpinner.classList.remove('hidden');
            } else {
                convertText.textContent = '🚀 Convert & Auto Download';
                convertSpinner.classList.add('hidden');
            }
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Check for impractical conversions
        function checkImpracticalConversion(fromExt, toFormat) {
            const impracticalConversions = {
                // PDF to DOCX - Complex formatting issues
                'pdf_to_docx': true,
                'pdf_to_doc': true,
                
                // Audio to Video - Cannot create video from audio only
                'mp3_to_mp4': true,
                'wav_to_mp4': true,
                'mp3_to_avi': true,
                'wav_to_avi': true,
                'mp3_to_mov': true,
                'wav_to_mov': true,
                'mp3_to_webm': true,
                'wav_to_webm': true,
                
                // Image to Audio/Video - Makes no sense
                'png_to_mp3': true,
                'jpg_to_mp3': true,
                'gif_to_mp4': true,
                'png_to_mp4': true,
                'jpg_to_mp4': true,
                
                // Text to Audio/Video - No practical use
                'txt_to_mp3': true,
                'txt_to_mp4': true,
                'json_to_mp3': true,
                'csv_to_mp4': true,
                
                // Binary formats that can't be meaningfully converted
                'exe_to_txt': true,
                'dll_to_pdf': true,
                'bin_to_html': true
            };
            
            return impracticalConversions[`${fromExt}_to_${toFormat}`] || false;
        }
        
        // Get error messages for impractical conversions
        function getConversionErrorMessage(fromExt, toFormat) {
            const errorMessages = {
                // PDF to DOCX issues
                'pdf_to_docx': '❌ PDF to DOCX conversion is not recommended!\n\n🔍 Why this fails:\n• Complex layouts get corrupted\n• Images and tables break\n• Formatting is lost\n\n💡 Better alternatives:\n• Use PDF to TXT for text extraction\n• Use online tools like SmallPDF\n• Edit original DOCX file instead',
                'pdf_to_doc': '❌ PDF to DOC conversion is not supported!\n\n💡 Recommended: Use PDF → TXT to extract text content',
                
                // Audio to Video impossibility
                'mp3_to_mp4': '❌ Cannot create MP4 video from MP3 audio!\n\n🔍 Why this is impossible:\n• MP3 is audio-only format\n• MP4 needs video content\n• No visual data to convert\n\n💡 What you can do:\n• Create slideshow with audio\n• Use video editing software\n• Add static image as background',
                'wav_to_mp4': '❌ Cannot create MP4 from WAV audio!\n\n💡 Suggestion: Use video editor to combine audio with images',
                'mp3_to_avi': '❌ Cannot create AVI video from MP3 audio!\n\n💡 Audio-only formats cannot become video files',
                'wav_to_avi': '❌ Cannot create AVI from WAV audio!\n\n💡 Need video content to create video files',
                
                // Image to media nonsense
                'png_to_mp3': '❌ Cannot create audio from PNG image!\n\n🔍 Images have no sound data to extract',
                'jpg_to_mp3': '❌ Cannot create audio from JPG image!\n\n💡 Try image format conversions instead',
                'gif_to_mp4': '❌ GIF to MP4 conversion needs special handling!\n\n💡 Use dedicated GIF to video converters',
                
                // Text to media nonsense
                'txt_to_mp3': '❌ Cannot create audio from text file!\n\n💡 Use text-to-speech software instead',
                'txt_to_mp4': '❌ Cannot create video from text file!\n\n💡 Try TXT → HTML for web display',
                
                // Generic fallback
                'default': `❌ ${fromExt.toUpperCase()} to ${toFormat.toUpperCase()} conversion is not practical!\n\n🔍 This conversion doesn't make technical sense or would result in data loss.\n\n💡 Try a different target format that's compatible with your source file.`
            };
            
            return errorMessages[`${fromExt}_to_${toFormat}`] || errorMessages['default'];
        }
        
        // Initialize
        console.log('🚀 FilePrompty Pro - Advanced Converter Ready!');
        console.log('📄 Supports: DOCX↔PDF, PDF→TXT, MP4→MP3, TXT→HTML & More!');
        console.log('⚡ Features: Auto-download, Progress tracking, Error recovery');
        console.log('❌ Smart error detection for impractical conversions');
    </script>
</body>
</html>